#!/usr/bin/env php
<?php

require 'vendor/autoload.php';

use clearice\ArgumentParser;
use clearice\ConsoleIO;
use ntentan\dev\commands\Init;
use ntentan\dev\commands\Build;
use ntentan\dev\commands\Serve;
use ntentan\panie\Container;


$parser = new ArgumentParser(new ConsoleIO());

$parser->addCommands([
    ['command' => 'serve', 'help' => 'Start the internal php server', 'data' => Serve::class],
    ['command' => 'build', 'help' => 'Run builds scripts to build assets and resources', 'data' => Build::class]
]);

$parser->addOptions([
    [
        'short' => 'p', 'long' => 'port', 'has_value' => true, 
        'help' => 'Server port value (defaults to 8080)',
        'default' => '8080',
        'command' => 'serve'
    ],
    [
        'short' => 'h', 'long' => 'host', 'has_value' => true, 
        'help' => 'Host to be bound to (defaults to 127.0.0.1)',
        'default' => '127.0.0.1',
        'command' => 'serve'
    ],
    [
        'short' => 'b', 'long' => 'insert-breakpoints',
        'help' => 'inserts an exception handler which callsed xdebug_break()',
        'command' => 'serve'
    ],

    // Options for build command
    [
        'short' => 'p', 'long' => 'public-dir', 'has_value' => true,
        'help' => 'Location of public directory',
        'default' => 'public',
        'command' => 'build'
    ],
    [
        'short' => 'a', 'long' => 'asset-pipeline', 'has_value' => true,
        'help' => 'Location of the asset pipeline file',
        'default' => 'asset_pipeline.php',
        'command' => 'build'
    ]
]);



$parser->addHelp();
$parser->setDescription('Ntentan PHP Framework Dev Tool');
$parser->setUsage("[command] [options] ...");
$parser->setStrict(true);
$parser->setFootnote('Report all bugs to jainooson@gmail.com');

$options = $parser->parse($argv);

if(empty($options) || count($options['stand_alones'] ?? []) > 0) {
    echo $parser->getHelpMessage();
    exit(1);
}

$container = new Container();
$container->resolve($options['data'])->run($options);
